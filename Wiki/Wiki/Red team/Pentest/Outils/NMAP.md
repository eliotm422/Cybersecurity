.pentest 
[[Readme (outils)]]
**

# Nmap 

## You have learned how ARP, ICMP, TCP, and UDP can detect live hosts by completing this room. Any response from a host is an indication that it is online. Below is a quick summary of the command-line options for Nmap that we have covered.

|   |   |
|---|---|
|## Scan Type|## Example Command|
|## ARP Scan|sudo nmap -PR -sn MACHINE_IP/24|
|ICMP Echo Scan|sudo nmap -PE -sn MACHINE_IP/24|
|ICMP Timestamp Scan|sudo nmap -PP -sn MACHINE_IP/24|
|ICMP Address Mask Scan|sudo nmap -PM -sn MACHINE_IP/24|
|TCP SYN Ping Scan|sudo nmap -PS22,80,443 -sn MACHINE_IP/30|
|TCP ACK Ping Scan|sudo nmap -PA22,80,443 -sn MACHINE_IP/30|
|UDP Ping Scan|sudo nmap -PU53,161,162 -sn MACHINE_IP/30|

## Remember to add -sn if you are only interested in host discovery without port-scanning. Omitting -sn will let Nmap default to port-scanning the live hosts.

|   |   |
|---|---|
|## Option|## Purpose|
|## -n|no DNS lookup|
|-R|reverse-DNS lookup for all hosts|
|-sn|host discovery only|

  

## This room covered three types of scans.

|   |   |
|---|---|
|## Port Scan Type|## Example Command|
|## TCP Connect Scan|nmap -sT MACHINE_IP|
|TCP SYN Scan|sudo nmap -sS MACHINE_IP|
|UDP Scan|sudo nmap -sU MACHINE_IP|

## These scan types should get you started discovering running TCP and UDP services on a target host.

|   |   |
|---|---|
|## Option|## Purpose|
|## -p-|all ports|
|-p1-1023|scan ports 1 to 1023|
|-F|100 most common ports|
|-r|scan ports in consecutive order|
|-T<0-5>|-T0 being the slowest and T5 the fastest|
|--max-rate 50|rate <= 50 packets/sec|
|--min-rate 15|rate >= 15 packets/sec|
|--min-parallelism 100|at least 100 probes in parallel|

  

|   |   |
|---|---|
|## Port Scan Type|## Example Command|
|## TCP Null Scan|sudo nmap -sN 10.10.27.104|
|TCP FIN Scan|sudo nmap -sF 10.10.27.104|
|TCP Xmas Scan|sudo nmap -sX 10.10.27.104|
|TCP Maimon Scan|sudo nmap -sM 10.10.27.104|
|TCP ACK Scan|sudo nmap -sA 10.10.27.104|
|TCP Window Scan|sudo nmap -sW 10.10.27.104|
|Custom TCP Scan|sudo nmap --scanflags URGACKPSHRSTSYNFIN 10.10.27.104|
|Spoofed Source IP|sudo nmap -S SPOOFED_IP 10.10.27.104|
|Spoofed MAC Address|--spoof-mac SPOOFED_MAC|
|Decoy Scan|nmap -D DECOY_IP,ME 10.10.27.104|
|Idle (Zombie) Scan|sudo nmap -sI ZOMBIE_IP 10.10.27.104|
|Fragment IP data into 8 bytes|-f|
|Fragment IP data into 16 bytes|-ff|

  

|   |   |
|---|---|
|## Option|## Purpose|
|## --source-port PORT_NUM|## specify source port number|
|## --data-length NUM|## append random data to reach given length|

## These scan types rely on setting TCP flags in unexpected ways to prompt ports for a reply. Null, FIN, and Xmas scan provoke a response from closed ports, while Maimon, ACK, and Window scans provoke a response from open and closed ports.

|   |   |
|---|---|
|## Option|## Purpose|
|## --reason|explains how Nmap made its conclusion|
|-v|verbose|
|-vv|very verbose|
|-d|debugging|
|-dd|more details for debugging|

  
  

|   |   |
|---|---|
|Script Category|Description|
|auth|Authentication related scripts|
|broadcast|Discover hosts by sending broadcast messages|
|brute|Performs brute-force password auditing against logins|
|default|Default scripts, same as -sC|
|discovery|Retrieve accessible information, such as database tables and DNS names|
|dos|Detects servers vulnerable to Denial of Service (DoS)|
|exploit|Attempts to exploit various vulnerable services|
|external|Checks using a third-party service, such as Geoplugin and Virustotal|
|fuzzer|Launch fuzzing attacks|
|intrusive|Intrusive scripts such as brute-force attacks and exploitation|
|malware|Scans for backdoors|
|safe|Safe scripts that won’t crash the target|
|version|Retrieve service versions|
|vuln|Checks for vulnerabilities or exploit vulnerable services|

  
  
  

|   |   |
|---|---|
|Option|Meaning|
|-sV|determine service/version info on open ports|
|-sV --version-light|try the most likely probes (2)|
|-sV --version-all|try all available probes (9)|
|-O|detect OS|
|--traceroute|run traceroute to target|
|--script=SCRIPTS|Nmap scripts to run|
|-sC or --script=default|run default scripts|
|-A|equivalent to -sV -O -sC --traceroute|
|-oN|save output in normal format|
|-oG|save output in grepable format|
|-oX|save output in XML format|
|-oA|save output in normal, XML and Grepable formats|

  
  

## Nmap : scan des ports : TCP

  
  

nmap <scan types> <options> <target>

sudo nmap -sS localhost

#cherche tous les ports TCP

sudo nmap -sV 10.129.109.36 #cherche le nom avec une adresse 

  

## Port TCP -> fichier HTML

sudo nmap -sS 10.129.109.36 -oA target

xsltproc target.xml -o target.html

sudo apt-get install lynx

lynx target.html

  
  
  

## Voir les ports 

sudo nmap 10.129.2.28 -p- -sV --stats-every=5s -v

#scan tous les ports et donne la version toutes les 5 sec

  

sudo nmap 10.129.2.28 -p- -sV -Pn -n --disable-arp-ping --packet-trace

#permet de donner plus d’informations sur le systeme de la machine

  

sudo nmap -sS

sudo nmap <IP> -sS - Pn #si cela ne réponds pas

sudo nmap 10.129.2.28 -p 80 -sV nc -nv <IP> <port>

#cherche des nformations à travers le port et l’adresse IP

  

  
  

## NMAP SCRIPTING : 

sudo nmap <IP> -p 80 -A #donne beaucoup d’informations pratique !  

--script vuln #cherche vuln 

  
  
  

|   |   |
|---|---|
|Category|Description|
|auth|Determination of authentication credentials.|
|broadcast|Scripts, which are used for host discovery by broadcasting and the discovered hosts, can be automatically added to the remaining scans.|
|brute|Executes scripts that try to log in to the respective service by brute-forcing with credentials.|
|default|Default scripts executed by using the -sC option.|
|discovery|Evaluation of accessible services.|
|dos|These scripts are used to check services for denial of service vulnerabilities and are used less as it harms the services.|
|exploit|This category of scripts tries to exploit known vulnerabilities for the scanned port.|
|external|Scripts that use external services for further processing.|
|fuzzer|This uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.|
|intrusive|Intrusive scripts that could negatively affect the target system.|
|malware|Checks if some malware infects the target system.|
|safe|Defensive scripts that do not perform intrusive and destructive access.|
|version|Extension for service detection.|
|vuln|Identification of specific vulnerabilities.|

  
  
  

sudo nmap 10.129.2.28 -p 80 -A  #scan Performs service detection, OS detection, traceroute and uses defaults scripts to scan the target.

sudo nmap 10.129.2.28 -p 80 -sV --script vuln

  

|   |   |
|---|---|
|-sV|Performs service version detection on specified ports.|
|--script vuln|Uses all related scripts from specified category.|

  
  
  
  
  

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5

# -sn : disables port scanning, -oA tnet stores the results in all formats starting with the name ‘tnet’

Minimuss74@htb[/htb]$ cat hosts.lst #Nmap also gives us the option of working with lists

Minimuss74@htb[/htb]$ sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5

  
  

Minimuss74@htb[/htb]$ sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d" " -f5

Minimuss74@htb[/htb]$ sudo nmap -sn -oA tnet 10.129.2.18-20| grep for | cut -d" " -f5

#scan plusieurs adresses pour les deux cas

  

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host 

#scan une seule IP

  
  

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host -PE --reason

#cette fois on envoie des paquets ICMP

  

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace --disable-arp-ping

#permet de désactiver les pings arp

  
  

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.28 --top-ports=10

#scan les 10 ports les plus connues de TCP

  
  

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.28 -p 21 --packet-trace -Pn -n --disable-arp-ping

#trace le paquet

  

sudo nmap 10.129.2.28 -p 443 --packet-trace --disable-arp-ping -Pn -n --reason -sT

#permet 

  

## Connected scan : 

Avantage : ne laisse pas de trace, mais prends plus de trace 

sudo nmap 10.129.2.28 -p 443 --packet-trace --disable-arp-ping -Pn -n --reason -sT

  

Les ports filtrés, ils laissent passer que certains paquets, il faut analyser les ports de manière différente :  

sudo nmap 10.129.2.28 -p 139 --packet-trace -n --disable-arp-ping -Pn

  

Des fois, le parefeu peut rejeter les paquets (durant entre renvoie bien différente), il faut alors penser à scanner sur le port 445

sudo nmap 10.129.2.28 -p 445 --packet-trace -n --disable-arp-ping -Pn

“As a response, we receive an ICMP reply with type 3 and error code 3, which indicates that the desired host is unreachable.”

sudo nmap 10.129.2.28 -sU -Pn -n --disable-arp-ping --packet-trace -p

  

sudo nmap 10.129.2.28 -Pn -n --disable-arp-ping --packet-trace -p 445 --reason  -sV

#sV donne des informations supplémentaires

  

## Scanner un DNS :

sudo apt-get install nmap

nmap --system-dns 10.1.21.6

  
  
  
  
  
  
  

|   |   |
|---|---|
|-sU|Performs a UDP scan.|
|-Pn|Disables ICMP Echo requests.|
|-n|Disables DNS resolution.|
|--disable-arp-ping|Disables ARP ping.|
|--packet-trace|Shows all packets sent and received.|
|-p 137|Scans only the specified port.|
|--reason|Displays the reason a port is in a particular state.|

  
  

## NMAP SCAN DE PORT UDP :

sudo nmap 10.129.2.28 -F -sU

#-F 100 ports -sU les ports UDP

  
  
  
  
  

 Use NSE and its scripts to find the flag that one of the services contain and submit it as the answer.

  

sudo nmap 10.129.183.87 -sS

montre tous les ports ouverts

Not shown: 993 closed tcp ports (reset)

PORT      STATE SERVICE

22/tcp    open  ssh

80/tcp    open  http

110/tcp   open  pop3

139/tcp   open  netbios-ssn

143/tcp   open  imap

445/tcp   open  microsoft-ds

31337/tcp open  Elite

  
  
  

sudo nmap 10.129.183.87 -F -sU

PORT    STATE         SERVICE

68/udp  open|filtered dhcpc

137/udp open          netbios-ns

138/udp open|filtered netbios-dgm

  

open port

  

sudo nmap 10.129.183.87 -p 80 --script vuln

  

curl http://10.129.183.87/robots.txt

  
  

## 2

 Our client wants to know if we can identify which operating system their provided machine is running on. Submit the OS name as the answer.

  

sudo nmap 10.129.77.237 -sS

Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-25 16:11 BST

Nmap scan report for 10.129.77.237

Host is up (0.033s latency).

Not shown: 869 closed tcp ports (reset), 128 filtered tcp ports (no-response)

PORT      STATE SERVICE

22/tcp    open  ssh

80/tcp    open  http

10001/tcp open  scp-config

  

Port 10001

  

sudo nmap 10.129.77.237 -p 22,80,10001 -sS -Pn -n --disable-arp-ping --packet-trace

  

sudo nmap 10.129.77.237 -p 22,80,10001 -sA -Pn -n --disable-arp-ping --packet-trace

  

AUCUN PROBLEME RIEN NE BLOQUE LE RETOUR

  

sudo nmap 10.129.77.237 -p 22,80,10001 -sS -Pn -n --disable-arp-ping --packet-trace -D RND:5

  

OK RAS

  

sudo nmap 10.129.77.237 -n -Pn -p22 -O

22/tcp open  ssh

  

sudo nmap 10.129.77.237 -n -Pn -p80 -O

PORT   STATE SERVICE

80/tcp open  http

  

sudo nmap 10.129.77.237 -n -Pn -p10001 -O

ORT      STATE SERVICE

10001/tcp open  scp-config

  

TOUS LES PORTS SONT OUVERTS

IMAGINONS un port 80 est filtré 

  

sudo nmap 10.129.2.28 -n -Pn -p 80 -O -S 10.129.2.200 -e tun0

  

On change l’ip par une autre pour permettre les règles de par feu

  
  

SYN-Scan of a Filtered Port

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.28 -p50000 -sS -Pn -n --disable-arp-ping --packet-trace

  

sudo nmap 10.129.77.237 -p10001 -sS -Pn -n --disable-arp-ping --packet-trace

  
  
  
  

SYN-Scan From DNS Port

Minimuss74@htb[/htb]$ sudo nmap 10.129.2.28 -p50000 -sS -Pn -n --disable-arp-ping --packet-trace --source-port 53

  
  

Connect To The Filtered Port

Minimuss74@htb[/htb]$ ncat -nv --source-port 53 10.129.2.28 50000

ncat -nv --source-port 53 10.129.2.28 50000

  
  
  
  

curl [http://10.129.117.1/status.php](http://10.129.117.1/status.php)

Recorded alerts: 20

/ 100 alerts

  

<br><br>

<button onClick="window.location.reload();">Refresh Page</button>

<br><br>

  
  
  

This page shows us the number of alerts. We know that if we receive a specific amount of alerts, we will be banned. Therefore we have to test the target system as quietly as possible.

  
  

binds dns service : 

sudo nmap -sSU -p 53 --script dns-nsid 10.129.2.48

  
  
  

 Now our client wants to know if it is possible to find out the version of the running services. Identify the version of service our client was talking about and submit the flag as the answer.

  

sudo nc -nv -p 53 10.129.135.173 50000

**